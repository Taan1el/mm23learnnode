"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.loadDependencies = loadDependencies;

var _getNodes = require("../ast/get-nodes");

var _getAddonsMeta = require("./get-addons-meta");

/**
 * @typedef {((string | Function)[])[]} InstancesList
 */

/**
 * Load filters and extensions modules
 *
 * @param {string} source
 * @param {Object.<string, string>} extensions
 * @param {Object.<string, string>} filters
 * @param {NunjucksOptions} nunjucksOptions
 * @returns {Promise<{filters: InstancesList, extensions: InstancesList, nodes: nunjucks.nodes.Root}>}
 */
async function loadDependencies(source, extensions, filters, nunjucksOptions) {
  const [extensionsInstances, filtersInstances] = await Promise.all([(0, _getAddonsMeta.getAddonsMeta)(Object.entries(extensions)), (0, _getAddonsMeta.getAddonsMeta)(Object.entries(filters))]);
  const nodes = (0, _getNodes.getNodes)(source, extensionsInstances.map(([,, ext]) => ext), nunjucksOptions);
  return {
    nodes,
    extensions: extensionsInstances,
    filters: filtersInstances
  };
}