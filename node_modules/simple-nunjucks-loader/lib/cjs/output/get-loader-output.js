"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getLoaderOutput = getLoaderOutput;

var _constants = require("../constants");

var _contants = require("../static-extension/contants");

var _getModuleOutput = require("./get-module-output");

function getLoaderOutput({
  templateImport,
  imports,
  defaultExport,
  precompiled,
  envOptions
}) {
  return `
        ${imports}
        ${precompiled}

        function nunjucksTemplate(ctx = {}) {
            const templateContext = {
                ${_contants.ASSETS_KEY}: ${_constants.TEMPLATE_DEPENDENCIES}.assets,
                ...ctx
            };

            var nunjucks = (${(0, _getModuleOutput.getModuleOutput)('runtime')})(
                ${envOptions},
                ${_constants.TEMPLATE_DEPENDENCIES}
            );

            if (nunjucks.isAsync()) {
                return nunjucks.renderAsync(
                    ${templateImport},
                    templateContext
                );
            }
        
            return nunjucks.render(
                ${templateImport},
                templateContext
            );
        };

        nunjucksTemplate.__nunjucks_precompiled_template__ = ${_constants.TEMPLATE_DEPENDENCIES}.templates[${templateImport}];
        nunjucksTemplate.${_constants.TEMPLATE_DEPENDENCIES} = ${_constants.TEMPLATE_DEPENDENCIES};

        ${defaultExport} nunjucksTemplate;
    `;
}